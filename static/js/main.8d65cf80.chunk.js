(window.webpackJsonpnotetaker=window.webpackJsonpnotetaker||[]).push([[0],{38:function(e,t,n){e.exports=n(62)},43:function(e,t,n){},45:function(e,t,n){},62:function(e,t,n){"use strict";n.r(t);var i=n(0),o=n.n(i),a=n(14),r=n.n(a),s=(n(43),n(9)),u=n.n(s),d=n(16),c=n(3),l=n(4),h=n(11),v=n(10),f=n(12),p=(n(45),n(46),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(v.a)(t).call(this,e))).interval=void 0,n.state={timestamp:n.props.initialTimestamp},n.interval=-1,n}return Object(f.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("span",{className:"timestamp"},this.state.timestamp.toLocaleString("en-us",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}))}},{key:"tick",value:function(){this.setState((function(e){return{timestamp:new Date}}))}},{key:"componentDidMount",value:function(){this.props.shouldTick&&this.setupTimer()}},{key:"componentDidUpdate",value:function(e,t){e.shouldTick!==this.props.shouldTick&&(this.props.shouldTick?this.setupTimer():window.clearInterval(this.interval))}},{key:"setupTimer",value:function(){var e=this;this.interval=window.setInterval((function(){return e.tick()}),500)}},{key:"componentWillUnmount",value:function(){window.clearInterval(this.interval)}}]),t}(o.a.Component)),m=n(37);function g(e){return new Array(e*w).fill(" ").join("")}var y,w=4,k=function(){function e(t,n,i){Object(c.a)(this,e),this.editTimestamp=t,this.note=n,this.content="",this.indentedUnits=0,this.creationTimestamp=void 0,this.creationTimestamp=new Date,this.indentedUnits=i||0}return Object(l.a)(e,[{key:"setCreationTimestamp",value:function(e){this.creationTimestamp=e}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(e,t){this.content=e,t&&this.setEditTimestamp(new Date)}},{key:"getLastEditTimestamp",value:function(){return this.editTimestamp}},{key:"setEditTimestamp",value:function(e){this.editTimestamp=e}},{key:"getIndentedUnits",value:function(){return this.indentedUnits}},{key:"setIndentedUnits",value:function(e){this.indentedUnits=e}},{key:"isEmpty",value:function(){return 0===this.content.trim().length}},{key:"convertToText",value:function(){return this.editTimestamp.toLocaleString("en-us",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})+" - "+g(this.indentedUnits)+this.content}},{key:"serialize",value:function(){return{id:this.id,content:this.content,indentedUnits:this.indentedUnits,editTimestamp:this.editTimestamp.getTime()}}},{key:"id",get:function(){return this.creationTimestamp.getTime()}}],[{key:"deserialize",value:function(t,n){var i=new e(new Date(n.editTimestamp),t,n.indentedUnits);return i.setContent(n.content),i.setCreationTimestamp(new Date(n.id)),i}}]),e}(),I=function(){function e(){Object(c.a)(this,e),this.noteLines=new Map,this.noteLineIdsOrdered=[],this.title=void 0,this.creationTime=void 0,this.finished=!1,this.driveId="",this.creationTime=new Date,this.title=this.makeDefaultTitle()}return Object(l.a)(e,[{key:"makeDefaultTitle",value:function(){return"Interview on "+this.creationTime.toLocaleDateString()}},{key:"addLine",value:function(e){var t=new k(new Date,this,e);return this.noteLines.set(t.id,t),this.noteLineIdsOrdered.push(t.id),t}},{key:"getLines",value:function(){return Array.from(this.noteLines.values())}},{key:"getLine",value:function(e){return this.noteLines.get(e)}},{key:"getFirstNoteLineId",value:function(){return Math.min.apply(Math,Object(m.a)(Array.from(this.noteLines.keys())))}},{key:"getTitle",value:function(){return this.title}},{key:"setTitle",value:function(e){this.title=e}},{key:"getFinished",value:function(){return this.finished}},{key:"setFinished",value:function(e){this.finished=e}},{key:"getDriveId",value:function(){return this.driveId||""}},{key:"setDriveId",value:function(e){this.driveId=e}},{key:"convertToText",value:function(){var e="";return this.noteLines.forEach((function(t){e+=t.convertToText()+"\n"})),e}},{key:"getPreviousRowId",value:function(e){var t=this.noteLineIdsOrdered.indexOf(e);return-1===t?null:this.noteLineIdsOrdered[Math.max(0,t-1)]}},{key:"deleteRow",value:function(e){this.noteLines.delete(e);var t=this.noteLineIdsOrdered.indexOf(e);-1!==t?this.noteLineIdsOrdered.splice(t):console.error("Tried to delete non-existent row with ID: ",e,this)}},{key:"setNoteLines",value:function(e,t){this.noteLineIdsOrdered=e,this.noteLines=t}},{key:"serialize",value:function(){var e=this;return{title:this.title,id:this.id,finished:this.finished,driveId:this.driveId,noteLines:this.noteLineIdsOrdered.map((function(t){var n=e.noteLines.get(t);if(void 0===n)throw console.error("Note: ",e),new Error("Got undefined note line during serialization.");return n.serialize()}))}}},{key:"id",get:function(){return this.creationTime.getTime()}}],[{key:"deserialize",value:function(t){var n=new e;n.setTitle(t.title),n.setFinished(t.finished),n.setDriveId(t.driveId);var i=t.noteLines.map((function(e){return k.deserialize(n,e)})),o=new Map;return i.forEach((function(e){return o.set(e.id,e)})),n.setNoteLines(t.noteLines.map((function(e){return e.id})),o),n}}]),e}(),b=new(function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,[{key:"saveNote",value:function(e){var t=this.getNoteStorageId(e);window.localStorage[t]=JSON.stringify(e.serialize()),window.localStorage.lastEditedNote=t}},{key:"getLastEditedNote",value:function(){var e=window.localStorage.lastEditedNote;if(void 0===e)return null;var t=window.localStorage[e];return void 0===t?(console.error("Tried to fetch non-existent note: ",e),null):I.deserialize(JSON.parse(t))}},{key:"getNoteStorageId",value:function(e){return"note-"+e.id}}]),e}()),S=new(function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,[{key:"updateNote",value:function(e){console.debug("Updating note: ",e),b.saveNote(e)}},{key:"getLastEditedNote",value:function(){return b.getLastEditedNote()}}]),e}()),N=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(h.a)(this,Object(v.a)(t).call(this,e))).timestampElement=o.a.createRef(),n.entryboxElement=o.a.createRef(),n.noteLine=void 0;var i=e.note.getLine(e.rowId);if(void 0===i)throw console.error("Note: ",e.note),new Error("Got bad row id. Provided row id: "+e.rowId);return n.noteLine=i,n.state={indentedUnits:n.noteLine.getIndentedUnits(),entryboxContent:n.computeEntryboxContent(n.noteLine.getIndentedUnits(),n.noteLine.getContent()),editedSinceLastFocus:!1},n}return Object(f.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"noterow ".concat(this.props.focused?"noterow-focused":"noterow-unfocused")},o.a.createElement(p,{ref:this.timestampElement,initialTimestamp:this.noteLine.getLastEditTimestamp(),shouldTick:this.computeTimestampShouldTick()}),o.a.createElement("textarea",{ref:this.entryboxElement,onFocus:this.handleEntryboxFocus.bind(this),onKeyDown:this.handleKeyDown.bind(this),onChange:this.handleChange.bind(this),value:this.state.entryboxContent,readOnly:!this.props.focused,rows:1,className:"entrybox"}))}},{key:"computeTimestampShouldTick",value:function(){if(this.props.note.getFinished())return!1;var e=0===this.state.entryboxContent.trim().length;return!(!e||!this.props.focused)||!(e||!this.state.editedSinceLastFocus)}},{key:"computeEntryboxContent",value:function(e,t){return g(e)+t.trim()}},{key:"componentDidUpdate",value:function(e,t){var n=this;t.indentedUnits!==this.state.indentedUnits&&(this.setState((function(e){return{entryboxContent:n.computeEntryboxContent(n.state.indentedUnits,n.state.entryboxContent)}})),this.noteLine.setIndentedUnits(this.state.indentedUnits)),t.entryboxContent!==this.state.entryboxContent&&(this.noteLine.setContent(this.state.entryboxContent,!0),S.updateNote(this.props.note)),e.focused===this.props.focused||this.props.focused||this.setState({editedSinceLastFocus:!1}),null!==this.entryboxElement.current&&this.props.focused&&this.entryboxElement.current.focus()}},{key:"componentDidMount",value:function(){null!==this.entryboxElement.current&&this.props.focused&&this.entryboxElement.current.focus()}},{key:"handleChange",value:function(e){this.setState({entryboxContent:e.target.value,editedSinceLastFocus:!0}),S.updateNote(this.props.note)}},{key:"handleKeyDown",value:function(e){this.props.keyDownHandler(this.noteLine,e)&&"Tab"===e.key&&(e.preventDefault(),e.shiftKey?this.setState((function(e){return{indentedUnits:Math.max(e.indentedUnits-1,0)}})):this.setState((function(e){return{indentedUnits:e.indentedUnits+1}})))}},{key:"handleEntryboxFocus",value:function(e){if(this.props.focusHandler(this.noteLine),0===this.state.entryboxContent.trim().length&&null!=this.entryboxElement.current){var t=this.entryboxElement.current.textLength;this.entryboxElement.current.setSelectionRange(t,t)}}}]),t}(o.a.Component),T=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(v.a)(t).call(this,e))).divRef=o.a.createRef(),n.state={editing:!1},n}return Object(f.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"note-title",ref:this.divRef,onClick:this.handleClick.bind(this),contentEditable:!0,onKeyDown:this.handleKeyDown.bind(this),onBlur:this.handleBlur.bind(this),suppressContentEditableWarning:!0},this.props.title)}},{key:"handleClick",value:function(e){this.setState({editing:!0})}},{key:"handleKeyDown",value:function(e){"Enter"===e.key&&null!==this.divRef.current&&(e.preventDefault(),this.props.titleChangeHandler(this.divRef.current.textContent||""),this.setState({editing:!1}),this.divRef.current.blur())}},{key:"handleBlur",value:function(e){null!==this.divRef.current&&(this.divRef.current.textContent=this.props.title)}}]),t}(o.a.Component),E=n(13),O=n(36),L=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],D="application/vnd.google-apps.document";!function(e){e[e.LOADING=0]="LOADING",e[e.SIGNED_OUT=1]="SIGNED_OUT",e[e.SIGNED_IN=2]="SIGNED_IN"}(y||(y={}));var x=new(function(){function e(){Object(c.a)(this,e),this.signedInEventHandlers=[]}return Object(l.a)(e,[{key:"init",value:function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",gapi.load("client:auth2",this.initClient.bind(this)));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initClient",value:function(){var e=this;gapi.client.init({apiKey:"AIzaSyBEH9v-TByqUFESw8vjl2YEDgAKoWm7n_8",clientId:"370774814885-7kseam56ntmpklgnr9p00f8gh968cmtb.apps.googleusercontent.com",discoveryDocs:L,scope:"https://www.googleapis.com/auth/drive.file"}).then((function(){gapi.auth2.getAuthInstance().isSignedIn.listen(e.handleIsSignedInState.bind(e)),e.handleIsSignedInState(gapi.auth2.getAuthInstance().isSignedIn.get())}))}},{key:"handleIsSignedInState",value:function(e){console.log("user is now",e);var t=e?y.SIGNED_IN:y.SIGNED_OUT,n=!0,i=!1,o=void 0;try{for(var a,r=this.signedInEventHandlers[Symbol.iterator]();!(n=(a=r.next()).done);n=!0){(0,a.value)(t)}}catch(s){i=!0,o=s}finally{try{n||null==r.return||r.return()}finally{if(i)throw o}}}},{key:"addSignInStateHandler",value:function(e){this.signedInEventHandlers.push(e)}},{key:"isUserSignedIn",value:function(){return gapi.auth2.getAuthInstance().isSignedIn.get()}},{key:"saveNote",value:function(){var e=Object(d.a)(u.a.mark((function e(t){var n,i,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Saving note to drive: ",t),0!==t.getDriveId().length){e.next=14;break}return e.next=4,this.getParentFolderId();case 4:return i=e.sent,e.next=7,gapi.client.drive.files.create({name:t.getTitle(),mimeType:D,parents:[i]});case 7:if(o=e.sent,console.log("Got create response: ",o),200===o.status){e.next=11;break}throw new Error("Got bad create response code");case 11:n=o.result.id,e.next=15;break;case 14:n=t.getDriveId();case 15:return e.next=17,this.uploadContent(t.getDriveId(),t.convertToText());case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getParentFolderId",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(t=window.localStorage["parent-drive-id"])){e.next=12;break}return e.next=4,gapi.client.drive.files.create({mimeType:"application/vnd.google-apps.folder",name:"Synced Interview Notes"});case 4:if(n=e.sent,console.log("got create response: ",n),200===n.status){e.next=8;break}throw new Error("Got bad create response code");case 8:t=n.result.id,window.localStorage["parent-drive-id"]=t,e.next=13;break;case 12:console.log("Reusing drive id: ",t);case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"uploadContent",value:function(){var e=Object(d.a)(u.a.mark((function e(t,n){var i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=new XMLHttpRequest).open("PATCH","https://www.googleapis.com/upload/drive/v3/files/"+t+"?uploadType=media"),i.setRequestHeader("Authorization","Bearer "+gapi.client.getToken().access_token),i.setRequestHeader("Content-Type",D),e.abrupt("return",new Promise((function(e,t){i.onload=function(){return e()},i.send(n)})));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}()),C=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(v.a)(t).call(this,e))).state={open:!1,driveSignInState:y.LOADING},x.addSignInStateHandler((function(e){n.setState({driveSignInState:e})})),n}return Object(f.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props.noteFinished?"Mark Note Unfinished":"Mark Note Finished",n=[];return this.state.driveSignInState===y.SIGNED_IN?n=[o.a.createElement(E.a.Item,{key:"signout",onClick:function(t){return e.props.signOutHandler()}},"Sign out of Google Drive")]:this.state.driveSignInState===y.SIGNED_OUT&&(n=[o.a.createElement(E.a.Item,{key:"signin",onClick:function(t){return e.props.signInHandler()}},"Sign into Google Drive")]),o.a.createElement(O.a,{alignRight:!0,id:"menu",title:"Menu"},o.a.createElement(E.a.Item,{onClick:function(t){return e.props.newNoteHandler()}},"New Note"),o.a.createElement(E.a.Item,{onClick:function(t){return e.props.finishToggleHandler()}},t),o.a.createElement(E.a.Divider,null),n)}},{key:"handleMenuIconClick",value:function(e){}},{key:"resetHandler",value:function(e){}}]),t}(o.a.Component),j=function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"view-in-docs-link"},this.props.noteDriveId.length>0&&o.a.createElement("a",{href:"https://docs.google.com/document/d/"+this.props.noteDriveId+"/edit",target:"_blank"},"View Note in Docs"))}}]),t}(o.a.Component),R=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(h.a)(this,Object(v.a)(t).call(this,e))).wrapperElement=o.a.createRef(),n.editedSinceLastDriveSync=!1,n.syncTimer=null,x.init();var i,a=S.getLastEditedNote();return i=null===a?(a=n.createNewNote()).getFirstNoteLineId():a.getFirstNoteLineId(),n.state={note:a,focusedNoteRowId:i},n}return Object(f.a)(t,e),Object(l.a)(t,[{key:"createNewNote",value:function(){var e=new I;return e.addLine(),e}},{key:"componentDidMount",value:function(){var e=this;x.addSignInStateHandler((function(t){t===y.SIGNED_IN?(x.saveNote(e.state.note),e.syncTimer=setInterval(Object(d.a)(u.a.mark((function t(){var n,i;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.editedSinceLastDriveSync){t.next=8;break}return t.next=3,x.saveNote(e.state.note);case 3:n=t.sent,(i=e.state.note).setDriveId(n),e.editedSinceLastDriveSync=!1,e.setState({note:i});case 8:case"end":return t.stop()}}),t)}))),2e3)):null!==e.syncTimer&&(clearTimeout(e.syncTimer),e.syncTimer=null)}))}},{key:"render",value:function(){var e=this,t=this.state.note.getLines().map((function(t){return o.a.createElement(N,{keyDownHandler:e.handleNoteRowKeyDown.bind(e),focusHandler:e.noteRowFocusHandler.bind(e),note:e.state.note,rowId:t.id,key:t.id,focused:t.id===e.state.focusedNoteRowId})}));return o.a.createElement("div",{className:"App",ref:this.wrapperElement},o.a.createElement("div",{className:"header"},o.a.createElement(T,{title:this.state.note.getTitle(),titleChangeHandler:this.handleTitleChange.bind(this)}),o.a.createElement(j,{noteDriveId:this.state.note.getDriveId()}),o.a.createElement(C,{noteFinished:this.state.note.getFinished(),newNoteHandler:this.newNoteHandler.bind(this),finishToggleHandler:this.handleToggleFinished.bind(this),signOutHandler:this.signOutHandler.bind(this),signInHandler:this.signInHandler.bind(this)})),t)}},{key:"signInHandler",value:function(){gapi.auth2.getAuthInstance().signIn()}},{key:"signOutHandler",value:function(){gapi.auth2.getAuthInstance().signOut()}},{key:"handleTitleChange",value:function(e){this.state.note.setTitle(e),this.setState({note:this.state.note}),S.updateNote(this.state.note)}},{key:"handleToggleFinished",value:function(){var e=this.state.note;e.setFinished(!e.getFinished()),this.setState({note:e})}},{key:"newNoteHandler",value:function(){var e=this.createNewNote();this.setState({note:e,focusedNoteRowId:e.getFirstNoteLineId()})}},{key:"handleNoteRowKeyDown",value:function(e,t){var n=this;if(this.editedSinceLastDriveSync=!0,"Enter"===t.key)return t.preventDefault(),this.setState((function(t,i){var o=n.state.note,a=o.addLine(e.getIndentedUnits());return{note:o,focusedNoteRowId:a.id}})),!1;if("Backspace"!==t.key)return!0;var i=this.state.note.getLine(this.state.focusedNoteRowId);if(void 0!==i&&i.isEmpty()&&this.state.note.getLines().length>1){var o=this.state.note.getPreviousRowId(this.state.focusedNoteRowId);this.state.note.deleteRow(this.state.focusedNoteRowId),null!==o?this.setState({focusedNoteRowId:o}):(console.error("Got a null previous row id relative to: ",this.state.focusedNoteRowId),this.setState({focusedNoteRowId:this.state.note.getFirstNoteLineId()})),S.updateNote(this.state.note),t.preventDefault()}}},{key:"noteRowFocusHandler",value:function(e){this.setState({focusedNoteRowId:e.id})}}]),t}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(R,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[38,1,2]]]);
//# sourceMappingURL=main.8d65cf80.chunk.js.map